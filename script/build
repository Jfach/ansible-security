#!/bin/bash
set -e

. script/options.bash

options="--rm"
echo $@ | grep '\--no-cache' &> /dev/null && options="$options --no-cache" || :

echo "Creating Staging Data volume"
docker create -v /opt/staging --name ${DATA_IMAGE} alpine true

echo "Building the Ansible Controller image"
docker build $options -f dockerfiles/dockerfile-ansible -t ${CONTROLLER_IMAGE} .

echo "Building the Autostager image"
docker build $options -f dockerfiles/dockerfile-autostager -t ${AUTOSTAGER_IMAGE} .

echo "Show Ansible image sizes."
docker images | grep ansible-security | sort

echo "Show Autostager image sizes."
docker images | grep autostager | sort

echo "Show all docker images"
docker images

echo
echo "WARN: you should docker tag the images."
echo
